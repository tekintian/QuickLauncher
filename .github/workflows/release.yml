# Description: GitHub Actions workflow to build and release QuickLauncher for macOS
# Triggers on new version tags (v*), builds Intel and ARM64 versions,
# creates release assets (DMG, ZIP, SHA256), and publishes to GitHub Releases.
# Uses self-signed code signing, with optional developer certificate signing.
# Generates detailed release notes highlighting features, improvements, and installation instructions.
# author: tekintian@gmail.com   https://dev.tekin.cn
# date: 2025-12-20
# version: 1.0.0
# license: MIT
name: Release

on:
  push:
    # Trigger release workflow on new version tags
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  create-release:
    runs-on: macos-14
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable
        
    - name: Update Package Dependencies for CI
      run: |
        echo "ğŸ“¦ Updating Xcode project to use remote dependencies for CI..."
        
        # Backup original project file
        cp QuickLauncher.xcodeproj/project.pbxproj QuickLauncher.xcodeproj/project-local.pbxproj
        
        # Update Xcode project to use remote ShortcutRecorder
        sed 's|repositoryURL = "file://./LocalDependencies/ShortcutRecorder";|repositoryURL = "https://github.com/tekintian/ShortcutRecorder.git";|g' QuickLauncher.xcodeproj/project.pbxproj > temp.pbxproj && mv temp.pbxproj QuickLauncher.xcodeproj/project.pbxproj
        
        # Also update Package.swift for consistency
        cat > Package-ci.swift << 'EOF'
        // swift-tools-version:5.3
        // Package definition for QuickLauncher with remote dependencies (CI only)
        
        import PackageDescription
        
        let package = Package(
            name: "QuickLauncher",
            platforms: [
                .macOS(.v10_15)
            ],
            dependencies: [
                // Use remote ShortcutRecorder dependency for CI builds
                .package(url: "https://github.com/tekintian/ShortcutRecorder.git", from: "3.4.0")
            ],
            targets: [
                // è¿™é‡Œå®šä¹‰é¡¹ç›®çš„ä¸»è¦ç›®æ ‡
                // æ³¨æ„ï¼šè¿™ä¸»è¦æ˜¯ä¸ºäº†åŒ…è§£æï¼Œå®é™…æ„å»ºä½¿ç”¨Xcodeé¡¹ç›®
            ]
        )
        EOF
        
        # Backup original Package.swift and use CI version
        cp Package.swift Package-local.swift
        cp Package-ci.swift Package.swift
        
        echo "âœ… Dependencies updated for CI build"
        
    - name: Cache Swift Package Manager
      uses: actions/cache@v4
      with:
        path: |
          .build
          ~/Library/Developer/Xcode/DerivedData
        key: ${{ runner.os }}-spm-${{ hashFiles('Package.swift', '*.xcodeproj/**') }}
        restore-keys: |
          ${{ runner.os }}-spm-
          
    - name: Build Release
      run: |
        # Set minimum macOS version for compatibility
        export MACOSX_DEPLOYMENT_TARGET=10.15
        
        # Clean previous builds
        rm -rf build
        rm -rf DerivedData*
        
        # Build Intel version for macOS 10.15 compatibility using Xcode project
        echo "ğŸ—ï¸ Building Intel (x86_64) version..."
        xcodebuild -project QuickLauncher.xcodeproj \
          -scheme QuickLauncher \
          -configuration Release \
          -arch x86_64 \
          -derivedDataPath DerivedData-Intel \
          MACOSX_DEPLOYMENT_TARGET=10.15 \
          ONLY_ACTIVE_ARCH=NO \
          CODE_SIGN_IDENTITY="" \
          CODE_SIGNING_REQUIRED=NO \
          CODE_SIGNING_ALLOWED=NO \
          ENABLE_BITCODE=NO \
          SWIFT_OPTIMIZATION_LEVEL=-O \
          PRODUCT_BUNDLE_IDENTIFIER=cn.tekin.QuickLauncher \
          MARKETING_VERSION=1.0.0 \
          CURRENT_PROJECT_VERSION=1 \
          DEVELOPMENT_LANGUAGE=en \
          -allowProvisioningUpdates \
          clean build
        
        # NOTE: Xcode build already includes all compiled resources
        # No manual resource copying needed - would corrupt the built app
        
        # Verify Intel build succeeded
        echo "ğŸ” Checking Intel build results..."
        if [ ! -d "DerivedData-Intel/Build/Products/Release/QuickLauncher.app" ]; then
          echo "âŒ Intel build failed - no app bundle found"
          find DerivedData-Intel -name "*.app" -type d || echo "No app bundles found"
          exit 1
        fi
        echo "ğŸ“‹ Intel app structure verification:"
        ls -la "DerivedData-Intel/Build/Products/Release/QuickLauncher.app/Contents/"
        
        # Copy Intel binary
        echo "ğŸ” Verifying Intel build output..."
        ls -la "DerivedData-Intel/Build/Products/Release/"
        if [ -d "DerivedData-Intel/Build/Products/Release/QuickLauncher.app" ]; then
          echo "âœ… Intel build successful, copying app..."
          # Remove existing copy and copy fresh from build output
          rm -rf QuickLauncher-Intel.app
          cp -R "DerivedData-Intel/Build/Products/Release/QuickLauncher.app" "QuickLauncher-Intel.app"
          
          # Ensure complete directory structure
          echo "ğŸ”§ Ensuring complete Intel app structure..."
          mkdir -p "QuickLauncher-Intel.app/Contents/{MacOS,Resources,Frameworks,PlugIns}"
          
          # Verify executable exists and is executable
          if [ -f "QuickLauncher-Intel.app/Contents/MacOS/QuickLauncher" ]; then
            chmod +x "QuickLauncher-Intel.app/Contents/MacOS/QuickLauncher"
            echo "âœ… Intel executable verified and permissions set"
          else
            echo "âŒ Intel executable missing"
            exit 1
          fi
          
          echo "ğŸ“‹ Intel app structure:"
          find QuickLauncher-Intel.app -name "*.plist" -o -name "QuickLauncher" | head -10
          
          # Verify binary architecture
          echo "ğŸ” Intel binary verification:"
          file "QuickLauncher-Intel.app/Contents/MacOS/QuickLauncher" || echo "âš ï¸ Could not verify binary"
          
          # Test Info.plist if exists
          if [ -f "QuickLauncher-Intel.app/Contents/Info.plist" ]; then
            echo "âœ… Intel Info.plist exists"
            /usr/libexec/PlistBuddy -c "Print CFBundleIdentifier" "QuickLauncher-Intel.app/Contents/Info.plist" || echo "âš ï¸ Could not read bundle identifier"
          else
            echo "âš ï¸ Intel Info.plist missing - will be created in packaging step"
          fi
        else
          echo "âŒ Intel build failed - no app found"
          exit 1
        fi
        
        # Build ARM64 version for macOS 11.0 compatibility
        echo "ğŸ—ï¸ Building Apple Silicon (ARM64) version..."
        xcodebuild -project QuickLauncher.xcodeproj \
          -scheme QuickLauncher \
          -configuration Release \
          -arch arm64 \
          -derivedDataPath DerivedData-ARM64 \
          MACOSX_DEPLOYMENT_TARGET=11.0 \
          ONLY_ACTIVE_ARCH=NO \
          CODE_SIGN_IDENTITY="" \
          CODE_SIGNING_REQUIRED=NO \
          CODE_SIGNING_ALLOWED=NO \
          ENABLE_BITCODE=NO \
          SWIFT_OPTIMIZATION_LEVEL=-O \
          PRODUCT_BUNDLE_IDENTIFIER=cn.tekin.QuickLauncher \
          MARKETING_VERSION=1.0.0 \
          CURRENT_PROJECT_VERSION=1 \
          DEVELOPMENT_LANGUAGE=en \
          -allowProvisioningUpdates \
          clean build
        
        # Ensure Resources are properly linked after build
        echo "ğŸ”— Ensuring proper resource linking for ARM64 build..."
        # NOTE: Xcode build already includes all compiled resources
        # No manual resource copying needed - would corrupt the built app
        
        # Verify ARM64 build succeeded
        echo "ğŸ” Checking ARM64 build results..."
        if [ ! -d "DerivedData-ARM64/Build/Products/Release/QuickLauncher.app" ]; then
          echo "âŒ ARM64 build failed - no app bundle found"
          find DerivedData-ARM64 -name "*.app" -type d || echo "No app bundles found"
          exit 1
        fi
        echo "ğŸ“‹ ARM64 app structure verification:"
        ls -la "DerivedData-ARM64/Build/Products/Release/QuickLauncher.app/Contents/"
        
        # Copy ARM64 binary
        echo "ğŸ” Verifying ARM64 build output..."
        ls -la "DerivedData-ARM64/Build/Products/Release/"
        if [ -d "DerivedData-ARM64/Build/Products/Release/QuickLauncher.app" ]; then
          echo "âœ… ARM64 build successful, copying app..."
          # Remove existing copy and copy fresh from build output
          rm -rf QuickLauncher-ARM64.app
          cp -R "DerivedData-ARM64/Build/Products/Release/QuickLauncher.app" "QuickLauncher-ARM64.app"
          
          # Ensure complete directory structure
          echo "ğŸ”§ Ensuring complete ARM64 app structure..."
          mkdir -p "QuickLauncher-ARM64.app/Contents/{MacOS,Resources,Frameworks,PlugIns}"
          
          # Verify executable exists and is executable
          if [ -f "QuickLauncher-ARM64.app/Contents/MacOS/QuickLauncher" ]; then
            chmod +x "QuickLauncher-ARM64.app/Contents/MacOS/QuickLauncher"
            echo "âœ… ARM64 executable verified and permissions set"
          else
            echo "âŒ ARM64 executable missing"
            exit 1
          fi
          
          echo "ğŸ“‹ ARM64 app structure:"
          find QuickLauncher-ARM64.app -name "*.plist" -o -name "QuickLauncher" | head -10
          
          # Verify binary architecture
          echo "ğŸ” ARM64 binary verification:"
          file "QuickLauncher-ARM64.app/Contents/MacOS/QuickLauncher" || echo "âš ï¸ Could not verify binary"
          
          # Test Info.plist if exists
          if [ -f "QuickLauncher-ARM64.app/Contents/Info.plist" ]; then
            echo "âœ… ARM64 Info.plist exists"
            /usr/libexec/PlistBuddy -c "Print CFBundleIdentifier" "QuickLauncher-ARM64.app/Contents/Info.plist" || echo "âš ï¸ Could not read bundle identifier"
          else
            echo "âš ï¸ ARM64 Info.plist missing - will be created in packaging step"
          fi
        else
          echo "âŒ ARM64 build failed - no app found"
          exit 1
        fi
        
        # Verify binary compatibility
        echo "ğŸ” Checking Intel binary compatibility:"
        file QuickLauncher-Intel.app/Contents/MacOS/QuickLauncher
        
        echo "ğŸ” Checking ARM64 binary compatibility:"
        file QuickLauncher-ARM64.app/Contents/MacOS/QuickLauncher
        
        # List available binaries
        echo "ğŸ“‹ Available binaries:"
        ls -la QuickLauncher-*.app
        
        # Comprehensive build verification
        echo ""
        echo "ğŸ” Final Comprehensive Build Verification:"
        
        for arch in Intel ARM64; do
          APP_NAME="QuickLauncher-$arch.app"
          echo ""
          echo "ğŸ“‹ $arch App Verification:"
          
          if [ -d "$APP_NAME" ]; then
            # Check executable
            if [ -f "$APP_NAME/Contents/MacOS/QuickLauncher" ]; then
              echo "  âœ… Executable: $(file "$APP_NAME/Contents/MacOS/QuickLauncher" | cut -d: -f2-)"
            else
              echo "  âŒ Missing executable"
            fi
            
            # Check Info.plist
            if [ -f "$APP_NAME/Contents/Info.plist" ]; then
              echo "  âœ… Info.plist exists"
              BUNDLE_ID=$(/usr/libexec/PlistBuddy -c "Print CFBundleIdentifier" "$APP_NAME/Contents/Info.plist" 2>/dev/null || echo "N/A")
              echo "    - Bundle ID: $BUNDLE_ID"
            else
              echo "  âŒ Info.plist missing"
            fi
            
            # Check Resources directory
            if [ -d "$APP_NAME/Contents/Resources" ]; then
              RESOURCE_COUNT=$(find "$APP_NAME/Contents/Resources" -type f | wc -l | tr -d ' ')
              echo "  âœ… Resources directory ($RESOURCE_COUNT files)"
              
              # Check for key resources
              [ -f "$APP_NAME/Contents/Resources/Assets.car" ] && echo "    âœ… Assets.car"
              [ -d "$APP_NAME/Contents/Resources/Assets.xcassets" ] && echo "    âœ… Assets.xcassets"
              [ -d "$APP_NAME/Contents/Resources/en.lproj" ] && echo "    âœ… en.lproj"
              [ -f "$APP_NAME/Contents/Resources/MainMenu.nib" ] && echo "    âœ… MainMenu.nib"
            else
              echo "  âŒ Resources directory missing"
            fi
            
            # Check Frameworks
            if [ -d "$APP_NAME/Contents/Frameworks" ]; then
              FRAMEWORK_COUNT=$(find "$APP_NAME/Contents/Frameworks" -name "*.dylib" | wc -l | tr -d ' ')
              echo "  âœ… Frameworks directory ($FRAMEWORK_COUNT dylib files)"
              
              # Check for Swift libraries
              [ -f "$APP_NAME/Contents/Frameworks/libswiftFoundation.dylib" ] && echo "    âœ… Swift Foundation"
              [ -f "$APP_NAME/Contents/Frameworks/libswiftAppKit.dylib" ] && echo "    âœ… Swift AppKit"
              [ -d "$APP_NAME/Contents/Frameworks/QuickLauncherCore.framework" ] && echo "    âœ… QuickLauncherCore"
            else
              echo "  âŒ Frameworks directory missing"
            fi
            
            # Check PlugIns
            if [ -d "$APP_NAME/Contents/PlugIns" ]; then
              echo "  âœ… PlugIns directory"
              [ -d "$APP_NAME/Contents/PlugIns/QuickLauncherFinderExtension.appex" ] && echo "    âœ… Finder Extension"
            else
              echo "  âš ï¸ PlugIns directory (optional for basic functionality)"
            fi
            
            echo "  ğŸ“Š App bundle size: $(du -sh "$APP_NAME" | cut -f1)"
          else
            echo "  âŒ App bundle not found"
          fi
        done
        
        echo ""
        echo "ğŸ‰ Build Summary:"
        echo "ğŸ“Š Architecture builds completed:"
        echo "  - Intel (x86_64): âœ…"
        if [ -d "QuickLauncher-Intel.app" ]; then
          echo "    - App bundle: $(du -sh QuickLauncher-Intel.app | cut -f1)"
          echo "    - Binary: $(file QuickLauncher-Intel.app/Contents/MacOS/QuickLauncher | cut -d: -f2-)"
        fi
        echo "  - ARM64 (Apple Silicon): âœ…"
        if [ -d "QuickLauncher-ARM64.app" ]; then
          echo "    - App bundle: $(du -sh QuickLauncher-ARM64.app | cut -f1)"
          echo "    - Binary: $(file QuickLauncher-ARM64.app/Contents/MacOS/QuickLauncher | cut -d: -f2-)"
        fi
        echo "  - Dependencies resolved: âœ…"
        echo "  - Ready for packaging: âœ…"
        echo ""

        # Restore original files
        if [ -f "Package-local.swift" ]; then
          echo "ğŸ”„ Restoring original Package.swift..."
          cp Package-local.swift Package.swift
        fi
        
        if [ -f "QuickLauncher.xcodeproj/project-local.pbxproj" ]; then
          echo "ğŸ”„ Restoring original Xcode project..."
          cp QuickLauncher.xcodeproj/project-local.pbxproj QuickLauncher.xcodeproj/project.pbxproj
        fi
      
    - name: Package Applications
      run: |
        # Create Intel version
        echo "ğŸ“¦ Packaging Intel version..."
        mkdir -p Release/Intel
        
        # Verify the complete app structure before packaging
        echo "ğŸ” Verifying Intel app structure before packaging..."
        
        # Check critical components
        MISSING_COMPONENTS=""
        if [ ! -f "QuickLauncher-Intel.app/Contents/MacOS/QuickLauncher" ]; then
          MISSING_COMPONENTS="$MISSING_COMPONENTS MacOS/QuickLauncher"
        fi
        if [ ! -d "QuickLauncher-Intel.app/Contents/Frameworks" ]; then
          MISSING_COMPONENTS="$MISSING_COMPONENTS Frameworks"
        fi
        if [ ! -d "QuickLauncher-Intel.app/Contents/Resources" ]; then
          MISSING_COMPONENTS="$MISSING_COMPONENTS Resources"
        fi
        
        if [ -n "$MISSING_COMPONENTS" ]; then
          echo "âŒ Intel app missing critical components: $MISSING_COMPONENTS"
          echo "ğŸ”„ Re-copying complete Intel app from build output..."
          rm -rf QuickLauncher-Intel.app
          cp -R DerivedData-Intel/Build/Products/Release/QuickLauncher.app QuickLauncher-Intel.app
          
          # Verify again after re-copy
          if [ ! -f "QuickLauncher-Intel.app/Contents/MacOS/QuickLauncher" ]; then
            echo "âŒ CRITICAL: Intel executable still missing after re-copy!"
            echo "Build output contents:"
            ls -la DerivedData-Intel/Build/Products/Release/QuickLauncher.app/Contents/ 2>/dev/null || echo "No Contents directory found"
            exit 1
          fi
        fi
        
        # Final verification of complete structure
        echo "âœ… Intel app final structure verification:"
        echo "  - Executable: $([ -f "QuickLauncher-Intel.app/Contents/MacOS/QuickLauncher" ] && echo "âœ…" || echo "âŒ")"
        echo "  - Frameworks: $([ -d "QuickLauncher-Intel.app/Contents/Frameworks" ] && echo "âœ…" || echo "âŒ")"
        echo "  - Resources: $([ -d "QuickLauncher-Intel.app/Contents/Resources" ] && echo "âœ…" || echo "âŒ")"
        echo "  - PlugIns: $([ -d "QuickLauncher-Intel.app/Contents/PlugIns" ] && echo "âœ…" || echo "âš ï¸")"
        
        # Ensure the app has correct permissions and structure
        chmod -R 755 QuickLauncher-Intel.app
        mv QuickLauncher-Intel.app Release/Intel/
        
        # Update Info.plist for Intel version (create if doesn't exist)
        INFO_PLIST="Release/Intel/QuickLauncher.app/Contents/Info.plist"
        if [ ! -f "$INFO_PLIST" ]; then
          echo "ğŸ“ Creating Info.plist for Intel version..."
          mkdir -p "$(dirname "$INFO_PLIST")"
          cp QuickLauncher/Info.plist "$INFO_PLIST"
          # Replace build variables with actual values
          sed -i '' 's/$(DEVELOPMENT_LANGUAGE)/en/g' "$INFO_PLIST"
          sed -i '' 's/$(EXECUTABLE_NAME)/QuickLauncher/g' "$INFO_PLIST"
          sed -i '' 's/$(PRODUCT_BUNDLE_IDENTIFIER)/cn.tekin.QuickLauncher/g' "$INFO_PLIST"
          sed -i '' 's/$(PRODUCT_NAME)/QuickLauncher/g' "$INFO_PLIST"
          sed -i '' 's/$(MARKETING_VERSION)/1.0.0/g' "$INFO_PLIST"
          sed -i '' 's/$(MACOSX_DEPLOYMENT_TARGET)/10.15/g' "$INFO_PLIST"
        fi
        
        /usr/libexec/PlistBuddy -c "Set :LSMinimumSystemVersion 10.15" "$INFO_PLIST"
        
        # Create ARM64 version
        echo "ğŸ“¦ Packaging ARM64 version..."
        mkdir -p Release/ARM64
        
        # Verify the app structure first
        echo "ğŸ” Verifying ARM64 app structure before packaging..."
        if [ ! -d "QuickLauncher-ARM64.app/Contents" ]; then
          echo "âŒ ARM64 app structure is incomplete. Checking build output..."
          ls -la QuickLauncher-ARM64.app/
          find DerivedData-ARM64/Build/Products/Release/ -name "*.app" -type d
          echo "ğŸ”„ Re-copying ARM64 app from build output..."
          cp -R DerivedData-ARM64/Build/Products/Release/QuickLauncher.app QuickLauncher-ARM64.app
        fi
        
        # Ensure the app has correct permissions and structure
        chmod -R 755 QuickLauncher-ARM64.app
        mv QuickLauncher-ARM64.app Release/ARM64/
        
        # Update Info.plist for ARM64 version (create if doesn't exist)
        INFO_PLIST="Release/ARM64/QuickLauncher.app/Contents/Info.plist"
        if [ ! -f "$INFO_PLIST" ]; then
          echo "ğŸ“ Creating Info.plist for ARM64 version..."
          mkdir -p "$(dirname "$INFO_PLIST")"
          cp QuickLauncher/Info.plist "$INFO_PLIST"
          # Replace build variables with actual values
          sed -i '' 's/$(DEVELOPMENT_LANGUAGE)/en/g' "$INFO_PLIST"
          sed -i '' 's/$(EXECUTABLE_NAME)/QuickLauncher/g' "$INFO_PLIST"
          sed -i '' 's/$(PRODUCT_BUNDLE_IDENTIFIER)/cn.tekin.QuickLauncher/g' "$INFO_PLIST"
          sed -i '' 's/$(PRODUCT_NAME)/QuickLauncher/g' "$INFO_PLIST"
          sed -i '' 's/$(MARKETING_VERSION)/1.0.0/g' "$INFO_PLIST"
          sed -i '' 's/$(MACOSX_DEPLOYMENT_TARGET)/11.0/g' "$INFO_PLIST"
        fi
        
        /usr/libexec/PlistBuddy -c "Set :LSMinimumSystemVersion 11.0" "$INFO_PLIST"
        
        # NOTE: Resources are already compiled and included by Xcode build
        # No need to copy source resources - they would corrupt the built app structure
        
        # Verify app structure
        for arch in Intel ARM64; do
          echo "ğŸ” Verifying $arch app structure:"
          find "Release/$arch/QuickLauncher.app" -name "*.png" -o -name "*.icns" | head -5 || echo "No icon files found"
          ls -la "Release/$arch/QuickLauncher.app/Contents/Resources/" | head -10 || echo "No Resources directory found"
        done
        
    - name: Code Sign (Self-Signed)
      run: |
        # Apply ad-hoc signatures to both versions
        echo "ğŸ” Signing Intel version..."
        codesign --force --deep --sign "-" --options runtime Release/Intel/QuickLauncher.app
        codesign --verify --verbose Release/Intel/QuickLauncher.app || true
        
        echo "ğŸ” Signing ARM64 version..."
        codesign --force --deep --sign "-" --options runtime Release/ARM64/QuickLauncher.app
        codesign --verify --verbose Release/ARM64/QuickLauncher.app || true
        
    - name: Code Sign (Optional - Developer Certificate)
      if: env.APPLE_SIGNING_IDENTITY != ''
      run: |
        echo "ğŸ›ï¸ Applying developer certificate signature..."
        codesign --force --verify --verbose --sign "${{ secrets.APPLE_SIGNING_IDENTITY }}" Release/Intel/QuickLauncher.app
        codesign --force --verify --verbose --sign "${{ secrets.APPLE_SIGNING_IDENTITY }}" Release/ARM64/QuickLauncher.app
      env:
        APPLE_SIGNING_IDENTITY: ${{ secrets.APPLE_SIGNING_IDENTITY }}
        
    - name: Create DMG
      run: |
        # Create DMG installers for both architectures
        chmod +x scripts/create-simple-dmg.sh
        
        echo "ğŸ“¦ Creating Intel DMG installer..."
        ./scripts/create-simple-dmg.sh "Release/Intel/QuickLauncher.app" "QuickLauncher-Intel.dmg"
        
        echo "ğŸ“¦ Creating ARM64 DMG installer..."
        ./scripts/create-simple-dmg.sh "Release/ARM64/QuickLauncher.app" "QuickLauncher-ARM64.dmg"
        
    - name: Create ZIP
      run: |
        # Create ZIP archives for both architectures
        cd Release/Intel
        zip -r ../../QuickLauncher-Intel.zip QuickLauncher.app
        cd ../ARM64
        zip -r ../../QuickLauncher-ARM64.zip QuickLauncher.app
        cd ../..
        
    - name: Generate Checksum
      run: |
        # Generate SHA256 checksums for all release files
        shasum -a 256 QuickLauncher-Intel.dmg > QuickLauncher-Intel.dmg.sha256
        shasum -a 256 QuickLauncher-ARM64.dmg > QuickLauncher-ARM64.dmg.sha256
        shasum -a 256 QuickLauncher-Intel.zip > QuickLauncher-Intel.zip.sha256
        shasum -a 256 QuickLauncher-ARM64.zip > QuickLauncher-ARM64.zip.sha256
        
    - name: Generate Release Notes
      run: |
        cat > release_notes.md << 'EOF'
        # ğŸš€ QuickLauncher v1.0.0 - é¦–ä¸ªæ­£å¼ç‰ˆå‘å¸ƒï¼

        > **QuickLauncher æ˜¯ä¸€æ¬¾ä¸“ä¸º macOS è®¾è®¡çš„å¼ºå¤§ç”Ÿäº§åŠ›å·¥å…·ï¼Œè®©ä½ ä» Finder å³é”®èœå•ç›´æ¥å¯åŠ¨ç»ˆç«¯å’Œä»£ç ç¼–è¾‘å™¨ï¼Œå½»åº•å‘Šåˆ«æ‰‹åŠ¨å¯¼èˆªç›®å½•çš„ç¹çæ“ä½œã€‚**

        ## ğŸ¯ ä¸ºä»€ä¹ˆé€‰æ‹© QuickLauncherï¼Ÿ

        **åŸºäº OpenInTerminal é¡¹ç›®å…¨é¢é‡æ„ï¼Œå¸¦æ¥é©å‘½æ€§æ”¹è¿›ï¼š**
        - ğŸš€ **ä½“ç§¯ç¼©å° 30%**ï¼šä» 32MB ä¼˜åŒ–è‡³ 22MBï¼Œä¸‹è½½æ›´å¿«ï¼Œå ç”¨æ›´å°‘ç©ºé—´
        - ğŸ§  **å†…å­˜ç®¡ç†ä¼˜åŒ–**ï¼šæ˜¾è‘—é™ä½èµ„æºå ç”¨ï¼Œæå‡ç³»ç»Ÿå“åº”é€Ÿåº¦
        - âš¡ **æ„å»ºé€Ÿåº¦æå‡ 50-70%**ï¼šæœ¬åœ°ä¾èµ–æ¶æ„ï¼Œå‘Šåˆ«ç½‘ç»œç­‰å¾…
        - ğŸ—ï¸ **ç°ä»£åŒ–æ¶æ„**ï¼šç»Ÿä¸€å¯åŠ¨ç®¡ç†ï¼Œå‘Šåˆ«è¾…åŠ©åº”ç”¨

        ## âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

        ### ğŸ–±ï¸ **æ— ç¼ Finder é›†æˆ**
        - å³é”®èœå•ç›´æ¥è®¿é—®ï¼Œè‡ªå®šä¹‰åº”ç”¨å›¾æ ‡æ˜¾ç¤º
        - æ™ºèƒ½å·å®—ç›‘æ§ï¼ŒåŠ¨æ€æ›´æ–°å¯ç”¨åº”ç”¨
        - å·¥å…·æ é›†æˆé€‰é¡¹ï¼Œå¿«é€Ÿè®¿é—®å¸¸ç”¨åŠŸèƒ½

        ### ğŸ“± **35+ åº”ç”¨ç¨‹åºæ”¯æŒ**
        
        **ğŸ–¥ï¸ ç»ˆç«¯åº”ç”¨ (10 æ¬¾)**
        - Terminal, iTerm, Hyper, Alacritty, kitty, Warp, WezTerm, Tabby, Ghostty
        
        **âœï¸ ç¼–è¾‘å™¨åº”ç”¨ (25+ æ¬¾)**
        - **ä¸»æµç¼–è¾‘å™¨**: VS Code, Sublime Text, Atom, VSCodium, BBEdit, TextMate
        - **ä¸“ä¸š IDE**: å®Œæ•´ JetBrains å¥—ä»¶ (AppCode, CLion, GoLand, IntelliJ IDEA, PhpStorm, PyCharm, RubyMine, WebStorm, Fleet)
        - **è‹¹æœå·¥å…·**: Xcode, TextEdit
        - **ç°ä»£ç¼–è¾‘å™¨**: Cursor, Nova, Zed, neovim
        - **ä¸“ä¸šå·¥å…·**: Typora (Markdown), MacVim

        ### ğŸŒ **9 è¯­è¨€å›½é™…åŒ–æ”¯æŒ**
        - è‡ªåŠ¨ (è·Ÿéšç³»ç»Ÿ), English, ç®€ä½“ä¸­æ–‡, Deutsch, EspaÃ±ol, FranÃ§ais, Italiano, í•œêµ­ì–´, Ğ ÑƒÑÑĞºĞ¸Ğ¹, TÃ¼rkÃ§e

        ### âš¡ **ç”Ÿäº§åŠ›å¢å¼º**
        - **å…¨å±€å¿«æ·é”®**ï¼šå¯è‡ªå®šä¹‰é”®ç›˜å¿«æ·é”®ï¼Œä¸€é”®å¯åŠ¨
        - **çŠ¶æ€æ é›†æˆ**ï¼šèœå•æ å¿«é€Ÿè®¿é—®ï¼Œè‡ªå®šä¹‰è¡Œä¸º
        - **è·¯å¾„å¤åˆ¶**ï¼šä¸€é”®å¤åˆ¶æ–‡ä»¶/æ–‡ä»¶å¤¹è·¯å¾„ï¼Œæ”¯æŒè½¬ä¹‰é€‰é¡¹
        - **è‡ªå®šä¹‰åº”ç”¨**ï¼šæ·»åŠ å’Œé…ç½®è‡ªå®šä¹‰åº”ç”¨ç¨‹åº
        - **å¿«é€Ÿåˆ‡æ¢**ï¼šå•å‡»åˆ‡æ¢æ“ä½œï¼Œæå‡ä½¿ç”¨æ•ˆç‡

        ## ğŸ› ï¸ æŠ€æœ¯åˆ›æ–°äº®ç‚¹

        ### ğŸ”§ **æœ¬åœ°ä¼˜å…ˆæ¶æ„**
        ```swift
        // å½»åº•å‘Šåˆ«ç½‘ç»œä¾èµ–
        repositoryURL = "file://./LocalDependencies/ShortcutRecorder"
        // æ„å»ºé€Ÿåº¦æå‡ 50-70%ï¼Œå®Œå…¨ç¦»çº¿æ„å»º
        ```

        ### ğŸ—ï¸ **ç»Ÿä¸€å¯åŠ¨ç®¡ç†ç³»ç»Ÿ**
        ```swift
        // å–ä»£æœ‰é—®é¢˜çš„è¾…åŠ©åº”ç”¨
        UnifiedLaunchManager.ensureSingleInstance()
        // ç°ä»£åŒ–å¯åŠ¨ç®¡ç†ï¼Œå®Œå–„ç”Ÿå‘½å‘¨æœŸ
        ```

        ### ğŸ›¡ï¸ **å…¨é¢é”™è¯¯å¤„ç†**
        - ç»Ÿä¸€é”™è¯¯ç®¡ç†ï¼Œæ‰€æœ‰ç»„ä»¶è¦†ç›–
        - ä¼˜é›…é™çº§æœºåˆ¶ï¼Œè¯¦ç»†æ—¥å¿—åé¦ˆ
        - ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

        ## ğŸ“Š æ€§èƒ½å¯¹æ¯”

        | ç‰¹æ€§ | OpenInTerminal åŸç‰ˆ | QuickLauncher v1.0.0 |
        |------|-------------------|---------------------|
        **åº”ç”¨ä½“ç§¯** | 32MB | **22MB** (-30%) |
        **æ„å»ºé€Ÿåº¦** | ç½‘ç»œä¾èµ–ï¼Œæ…¢ | **æœ¬åœ°ä¾èµ–ï¼Œå¿« 50-70%** |
        **åº”ç”¨æ”¯æŒ** | 10+ | **35+** (+250%) |
        **è¯­è¨€æ”¯æŒ** | 1 ç§ | **9 ç§** (+800%) |
        **æ¶æ„** | è¾…åŠ©åº”ç”¨ | **ç»Ÿä¸€å¯åŠ¨ç®¡ç†** |
        **æ–‡æ¡£** | åŸºç¡€ | **å®Œæ•´æ–‡æ¡£ç³»ç»Ÿ** |

        ## ğŸ—ï¸ æ¶æ„æ”¯æŒè¯´æ˜

        æœ¬ç‰ˆæœ¬æ”¯æŒå¤šæ¶æ„ï¼Œè¯·æ ¹æ®ä½ çš„ Mac èŠ¯ç‰‡é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬ï¼š

        | æ¶æ„ç‰ˆæœ¬ | æ”¯æŒç³»ç»Ÿ | é€‚ç”¨è®¾å¤‡ | ä¸‹è½½æ–‡ä»¶ |
        |---------|---------|---------|---------|
        **Intel (x86_64)** | macOS 10.15+ | Intel èŠ¯ç‰‡ Mac | `QuickLauncher-Intel.dmg/zip` |
        **Apple Silicon (ARM64)** | macOS 11.0+ | M123 èŠ¯ç‰‡ Mac | `QuickLauncher-ARM64.dmg/zip` |

        ## ğŸ”§ å®‰è£…æ–¹æ³•

        ### ğŸ“¦ **æ–¹æ³• 1: DMG å®‰è£…åŒ… (æ¨è)**
        1. æ ¹æ®èŠ¯ç‰‡é€‰æ‹©ç‰ˆæœ¬ï¼š`QuickLauncher-Intel.dmg` æˆ– `QuickLauncher-ARM64.dmg`
        2. åŒå‡»æŒ‚è½½ï¼Œæ‹–æ‹½åº”ç”¨åˆ° Applications æ–‡ä»¶å¤¹
        3. é¦–æ¬¡è¿è¡Œå¯èƒ½éœ€è¦å…è®¸è¿è¡Œ

        ### ğŸ“ **æ–¹æ³• 2: ZIP å‹ç¼©åŒ…**
        1. é€‰æ‹©å¯¹åº”æ¶æ„ç‰ˆæœ¬ï¼š`QuickLauncher-Intel.zip` æˆ– `QuickLauncher-ARM64.zip`
        2. è§£å‹åå°† `QuickLauncher.app` å¤åˆ¶åˆ° Applications æ–‡ä»¶å¤¹

        ## ğŸ” æƒé™é…ç½®

        **å¿…éœ€æƒé™ï¼š**
        - **Apple Events æƒé™**ï¼šä¸ Finder äº¤äº’ï¼Œè·å–æ–‡ä»¶è·¯å¾„
        - **è¾…åŠ©åŠŸèƒ½æƒé™**ï¼šç›‘å¬å¿«æ·é”®å’Œç³»ç»Ÿäº‹ä»¶ï¼ˆå¦‚éœ€è¦ï¼‰

        **è®¾ç½®æ–¹æ³•ï¼š**
        1. æ‰“å¼€ **ç³»ç»Ÿè®¾ç½® > éšç§ä¸å®‰å…¨æ€§**
        2. ç‚¹å‡» **è¾…åŠ©åŠŸèƒ½** æˆ– **è‡ªåŠ¨åŒ–**
        3. æ·»åŠ  QuickLauncher å¹¶å‹¾é€‰å…è®¸
        4. é‡å¯åº”ç”¨ä½¿æƒé™ç”Ÿæ•ˆ

        ## ğŸ® ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

        ### ğŸ“‚ **å¼€å‘è€…å·¥ä½œæµ**
        1. åœ¨ Finder ä¸­æ‰¾åˆ°é¡¹ç›®æ–‡ä»¶å¤¹
        2. å³é”®é€‰æ‹© "Open in Terminal" â†’ ç›´æ¥åœ¨é¡¹ç›®è·¯å¾„æ‰“å¼€ç»ˆç«¯
        3. å³é”®é€‰æ‹© "Open in VS Code" â†’ ç›´æ¥åœ¨ VS Code ä¸­æ‰“å¼€é¡¹ç›®
        4. ä½¿ç”¨å¿«æ·é”® `âŒ˜+â‡§+Q` å¿«é€Ÿè®¿é—® QuickLauncher ä¸»ç•Œé¢

        ### ğŸš€ **è®¾è®¡å¸ˆå·¥ä½œæµ**
        1. å³é”®è®¾è®¡æ–‡ä»¶ â†’ "Open in Photoshop" ç›´æ¥ç¼–è¾‘
        2. å¤åˆ¶æ–‡ä»¶è·¯å¾„ â†’ å¿«é€Ÿåˆ†äº«ç»™å›¢é˜Ÿæˆå‘˜
        3. çŠ¶æ€æ å¿«é€Ÿè®¿é—® â†’ å¯åŠ¨å¸¸ç”¨è®¾è®¡å·¥å…·

        ## âŒ¨ï¸ é»˜è®¤å¿«æ·é”®

        | å¿«æ·é”® | åŠŸèƒ½ |
        |--------|------|
        `âŒ˜ + â‡§ + Q` | æ‰“å¼€ QuickLauncher ä¸»ç•Œé¢ |
        `âŒ˜ + â‡§ + C` | å¤åˆ¶å½“å‰æ–‡ä»¶è·¯å¾„ |
        `âŒ˜ + â‡§ + R` | åˆ·æ–°åº”ç”¨åˆ—è¡¨ |

        ## ğŸ¯ ç‰ˆæœ¬é‡Œç¨‹ç¢‘

        **v1.0.0 æ ‡å¿—ç€ QuickLauncher ä»å®éªŒé¡¹ç›®å‘ä¸“ä¸šç”Ÿäº§åŠ›å·¥å…·çš„å®Œå…¨è½¬å˜ï¼š**

        ### âœ… **æŠ€æœ¯æˆç†Ÿåº¦**
        - ç”Ÿäº§å°±ç»ªçš„æ¶æ„ï¼Œå…¨é¢é”™è¯¯å¤„ç†
        - ä¸“ä¸šæ„å»ºç³»ç»Ÿï¼ŒCI/CD è‡ªåŠ¨åŒ–
        - å®Œæ•´æ–‡æ¡£å’Œå¼€å‘è€…èµ„æº

        ### ğŸ¨ **ç”¨æˆ·ä½“éªŒ**
        - æ˜¾è‘—æ€§èƒ½æ”¹è¿›ï¼ˆä½“ç§¯å° 30%ï¼Œæ„å»ºå¿« 50-70%ï¼‰
        - æ‰©å±•åº”ç”¨æ”¯æŒï¼ˆ35+ vs åŸç‰ˆ 10+ï¼‰
        - å¤šè¯­è¨€æ”¯æŒå’Œè‡ªå®šä¹‰é…ç½®

        ### ğŸ›ï¸ **é¡¹ç›®æ²»ç†**
        - å»ºç«‹è´¡çŒ®æŒ‡å—å’Œå®‰å…¨ç­–ç•¥
        - ä¸“ä¸šæ–‡æ¡£ç»“æ„
        - ç¤¾åŒºå¯¼å‘å¼€å‘æ–¹æ³•

        ## ğŸ”— ç›¸å…³é“¾æ¥

        - ğŸ“– [ä½¿ç”¨æ–‡æ¡£](https://github.com/tekintian/QuickLauncher/blob/main/README.md)
        - ğŸš€ [å¿«é€Ÿå¼€å§‹](https://github.com/tekintian/QuickLauncher/blob/main/QUICK_START.md)
        - ğŸ› ï¸ [æ„å»ºè¯´æ˜](https://github.com/tekintian/QuickLauncher/blob/main/docs/BUILD_INSTRUCTIONS.md)
        - ğŸ› [é—®é¢˜åé¦ˆ](https://github.com/tekintian/QuickLauncher/issues)
        - ğŸ¤ [è´¡çŒ®æŒ‡å—](https://github.com/tekintian/QuickLauncher/blob/main/CONTRIBUTING.md)

        ## ğŸ“ˆ æ–‡ä»¶æ ¡éªŒ

        **éªŒè¯ä¸‹è½½æ–‡ä»¶å®Œæ•´æ€§ï¼š**
        ```bash
        # Intel ç‰ˆæœ¬
        shasum -a 256 -c QuickLauncher-Intel.dmg.sha256
        
        # ARM64 ç‰ˆæœ¬  
        shasum -a 256 -c QuickLauncher-ARM64.dmg.sha256
        ```

        ---

        **ğŸŒŸ å¦‚æœ QuickLauncher å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·è€ƒè™‘ç»™é¡¹ç›®ä¸€ä¸ª Starï¼**
        EOF
        
    - name: Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          QuickLauncher-Intel.dmg
          QuickLauncher-Intel.dmg.sha256
          QuickLauncher-ARM64.dmg
          QuickLauncher-ARM64.dmg.sha256
          QuickLauncher-Intel.zip
          QuickLauncher-Intel.zip.sha256
          QuickLauncher-ARM64.zip
          QuickLauncher-ARM64.zip.sha256
        body_path: release_notes.md
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}